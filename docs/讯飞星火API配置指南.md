# 讯飞星火API配置指南

## API密钥配置

已成功配置讯飞星火API密钥：

- **AppID**: `e3532dea`
- **API Key**: `59d89dca17cd2f2f53c76a971cdc4719`  
- **API Secret**: `N2FlMmFhZmY5Y2IwNjk2YWI4YWVlOTcx`

## API调用说明

### 1. 诗词分析功能
后端服务已集成讯飞星火大模型，提供诗词分析功能：

```python
# API调用示例
response = await get_ai_analysis(AIAnalysisRequest(
    poem_title="静夜思",
    poem_author="李白", 
    poem_content="床前明月光，疑是地上霜。举头望明月，低头思故乡。"
))
```

### 2. 分析内容格式
讯飞星火将生成包含以下三部分的结构化分析：

- **创作背景**：诗词创作的历史背景和作者情况
- **意象解读**：诗中关键意象的含义解释
- **情感表达**：诗词传达的核心情感

### 3. 缓存机制
- 分析结果自动缓存24小时
- 避免重复调用API产生额外费用
- 支持缓存命中检查

## 费用说明

### 计费方式
- 讯飞星火API按调用次数计费
- 当前使用"星火认知大模型3.0 Lite"版本
- 具体费用请参考讯飞开放平台定价

### 成本控制建议
1. **启用缓存**：相同诗词分析结果缓存24小时
2. **批量处理**：避免频繁调用同一诗词
3. **监控用量**：定期检查API调用统计

## 错误处理

### 常见错误及解决方案

#### 1. API密钥错误
```json
{
  "code": 401,
  "error": "API密钥无效"
}
```
**解决方案**：检查API密钥配置是否正确

#### 2. 频率限制
```json
{
  "code": 429, 
  "error": "请求频率超限"
}
```
**解决方案**：降低调用频率，使用缓存机制

#### 3. 网络连接问题
```json
{
  "code": 500,
  "error": "网络连接失败"
}
```
**解决方案**：检查网络连接，重试机制

## 测试验证

### 1. 配置验证
```bash
cd backend
python spark_api.py
```
输出应为：`API配置验证成功`

### 2. 服务测试
```bash
python start_backend.py
```
访问：http://localhost:8000/docs 查看API文档

### 3. 功能测试
使用Postman或前端界面测试诗词分析功能

## 安全注意事项

### 1. API密钥保护
- 不要将API密钥提交到版本控制系统
- 使用环境变量管理敏感信息
- 定期轮换API密钥

### 2. 访问控制
- 限制API调用频率
- 监控异常调用行为
- 设置用量告警

## 后续优化建议

### 1. 性能优化
- 实现异步API调用
- 添加请求队列管理
- 优化提示词模板

### 2. 功能扩展
- 支持多模型切换
- 添加分析结果评分
- 实现批量分析功能

## 技术支持

如有问题请联系：
- 讯飞开放平台技术支持
- 项目开发团队
- 查看API文档：https://www.xfyun.cn/doc/spark