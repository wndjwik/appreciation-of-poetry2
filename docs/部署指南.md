# 诗鉴项目部署指南

## 环境要求
- Python 3.8+
- Node.js 14+
- Redis 6.0+
- 讯飞星火API账号

## 后端部署

### 1. 安装依赖
```bash
cd backend
pip install -r requirements.txt
```

### 2. 配置环境变量
创建 `.env` 文件：
```env
# 讯飞星火API配置
SPARK_API_KEY=your_api_key
SPARK_API_SECRET=your_api_secret

# Redis配置
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0

# 服务配置
SERVER_HOST=0.0.0.0
SERVER_PORT=8000
```

### 3. 启动Redis服务
```bash
# Windows
redis-server

# Linux/Mac
sudo systemctl start redis
```

### 4. 启动后端服务
```bash
python main.py
```

## 前端部署

### 1. 初始化项目
```bash
cd frontend
npm install
```

### 2. 开发环境运行
```bash
# H5版本
npm run dev:h5

# 微信小程序
npm run dev:mp-weixin
```

### 3. 生产环境构建
```bash
# H5版本
npm run build:h5

# 微信小程序
npm run build:mp-weixin
```

## 数据准备

### 1. 诗词数据格式
诗词数据存储在 `data/` 目录下，文件命名格式为 `朝代-题材诗.txt`，内容格式：
```
标题|作者|朝代|原文|基础注释
静夜思|李白|唐|床前明月光，疑是地上霜。举头望明月，低头思故乡。|霜：这里指月光像霜一样洁白；举头：抬头
```

### 2. 添加新诗词
在对应的TXT文件末尾添加新行即可。

## 讯飞星火API配置

### 1. 申请API密钥
1. 访问 [讯飞开放平台](https://www.xfyun.cn/)
2. 注册账号并实名认证
3. 创建"诗词赏析"应用
4. 获取API Key和Secret Key

### 2. 配置API参数
在后端代码中配置讯飞星火API参数：
```python
spark = SparkAPI(
    api_key="你的api_key",
    api_secret="你的api_secret",
    model="spark-lite-3.0"
)
```

## 生产环境部署建议

### 1. 使用进程管理器
推荐使用 PM2 管理后端进程：
```bash
npm install -g pm2
pm2 start backend/main.py --name poetry-api
```

### 2. 配置反向代理
使用 Nginx 作为反向代理：
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        proxy_pass http://localhost:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

### 3. 安全配置
- 使用HTTPS
- 配置API访问限制
- 定期备份数据
- 监控服务状态

## 故障排除

### 常见问题
1. **Redis连接失败**: 检查Redis服务是否启动
2. **API调用失败**: 检查讯飞星火API密钥配置
3. **文件读取失败**: 检查诗词文件路径和权限
4. **前端请求失败**: 检查后端服务地址和端口

### 日志查看
后端日志输出到控制台，前端可在浏览器开发者工具中查看网络请求。